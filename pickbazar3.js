var svg = `<svg class="mr-4"
xmlns="http://www.w3.org/2000/svg" width="18px" height="18px" viewBox="0 0 18 18">
<g data-name="Layer 2">
    <g data-name="Layer 3">
        <path data-name="Path 16"
            d="M10.235 3.966a2.943 2.943 0 00-1.38-2.122c-.528-.243-.485-.618-.338-.854s.41-.231.832.164a5 5 0 011.368 2.87z"
            fill="currentColor" stroke="currentColor" stroke-miterlimit="10"
            stroke-width=".416"></path>
        <path data-name="Path 17"
            d="M6.514 7.976a4.757 4.757 0 109.513 0c0-2.627-1.5-4.976-4.757-4.73-2.619.197-4.767 1.656-4.756 4.73z"
            fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"
            stroke-width="1.387"></path>
        <path data-name="Path 18"
            d="M6.514 7.976a4.757 4.757 0 109.513 0c0-2.627-1.5-4.976-4.757-4.73-2.619.197-4.767 1.656-4.756 4.73z"
            fill="currentColor"></path>
        <path data-name="Path 19"
            d="M14.731 5.045s1.506 1.544.714 2.993c-.287.526-1.2.192-1.234-.485s.25-1.27-.236-2.05c-.349-.566.26-.878.756-.458z"
            fill="#fff"></path>
        <path data-name="Path 20"
            d="M10.834 3.413s1.161-4.315 6.469-2.048c0 0-2.459 4.074-6.469 2.048z"
            stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"
            stroke-width="1.387"></path>
        <path data-name="Path 21"
            d="M10.834 3.413s1.161-4.315 6.469-2.048c0 0-2.459 4.074-6.469 2.048z"
            fill="#fff"></path>
        <path data-name="Path 22"
            d="M10.516 4.513a10.193 10.193 0 015.63-2.863c-2.736-.521-6.018 1.748-6.018 1.748s.289.864.388 1.115z"
            fill="currentColor" stroke="currentColor" stroke-linecap="round"
            stroke-linejoin="round" stroke-width=".035"></path>
        <path data-name="Path 23"
            d="M10.895 9.896h0c-.268-.877-1.969-1.65-4.234-1.72a5.286 5.286 0 00-4.515 1.858 2 2 0 00-.551 1.308h0a4.934 4.934 0 004.768 4.426c3.133.223 3.786-.96 4.225-1.9a6.363 6.363 0 00.307-3.972z"
            fill="#fff" stroke="#fff" stroke-linecap="round" stroke-linejoin="round"
            stroke-width="3.19"></path>
        <path data-name="Path 24"
            d="M10.895 9.896h0c-.268-.877-1.969-1.65-4.234-1.72a5.286 5.286 0 00-4.515 1.858 2 2 0 00-.551 1.308h0a4.934 4.934 0 004.768 4.426c3.133.223 3.786-.96 4.225-1.9a6.363 6.363 0 00.307-3.972z"
            fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"
            stroke-width="1.387"></path>
        <path data-name="Path 25"
            d="M10.895 9.896h0c-.268-.877-1.969-1.65-4.234-1.72a5.286 5.286 0 00-4.515 1.858 2 2 0 00-.551 1.308h0a4.934 4.934 0 004.768 4.426c3.133.223 3.786-.96 4.225-1.9a6.363 6.363 0 00.307-3.972z"
            fill="#fff" stroke="currentColor" stroke-miterlimit="10" stroke-width=".069">
        </path>
        <path data-name="Path 26"
            d="M10.895 9.896c-.268-.877-1.969-1.65-4.234-1.72a5.286 5.286 0 00-4.515 1.858 2 2 0 00-.551 1.308 4.934 4.934 0 004.768 4.426c3.133.223 3.786-.96 4.225-1.9a6.363 6.363 0 00.307-3.972z"
            fill="currentColor"></path>
        <path data-name="Path 27"
            d="M1.595 11.342a4.375 4.375 0 00.128.684 2.664 2.664 0 00.3.335c1.067 1.028 4.409 1.723 7.173 1 .883-.23 1.522-1.3.526-1.851-.139-.076-.243-.184-.208-.277s.089-.106.269-.1a1.2 1.2 0 001.232-.735 4.126 4.126 0 00-.121-.509c-.272-.876-1.974-1.644-4.239-1.715a5.286 5.286 0 00-4.515 1.858 2.024 2.024 0 00-.545 1.31z"
            fill="#fff"></path>
        <path data-name="Path 28"
            d="M1.921 9.984a1.569 1.569 0 00.1 2.377c1.066 1.028 4.409 1.723 7.173 1 .883-.23 1.522-1.3.526-1.851-.139-.076-.243-.184-.208-.277s.089-.106.269-.1a1.183 1.183 0 001.259-.823 1.321 1.321 0 00-.785-1.413"
            fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"
            stroke-width=".416"></path>
        <path data-name="Path 29"
            d="M8.013 10.78c-.018.471-.87.791-1.9.752s-1.856-.423-1.837-.9.87-.963 1.9-.924 1.855.605 1.837 1.072z"
            fill="currentColor" stroke="currentColor" stroke-linecap="round"
            stroke-linejoin="round" stroke-width=".555"></path>
        <path data-name="Path 30"
            d="M9.722 12.123a2.411 2.411 0 01.467 2.08 2.759 2.759 0 01-1.5 2.427"
            fill="none" stroke="#fff" stroke-linecap="round" stroke-linejoin="round"
            stroke-width=".555"></path>
    </g>
</g>
</svg>`;
// silir
function itemRemove(id) {
  let exit_button = document.querySelectorAll(`[product_id="${id}"]`)
  let product_count = parseInt(exit_button[0].querySelector('.products-count').textContent);
  let product_allsum = parseFloat(document.querySelector('.all-sum').textContent);
  let product_sum = parseFloat(exit_button[0].querySelector('.products-money').textContent);
  let product_cardprice = exit_button[0].querySelector('.card-text').innerHTML;
  product_cardprice = parseFloat(product_cardprice.replace('$', ''));
  let product_item = parseInt(document.querySelector('.backet-item').textContent);
  product_allsum = parseFloat(product_allsum - product_sum).toFixed(2);
  product_count = parseInt(product_count);
  console.log(product_allsum);
  product_item--;
  exit_button[0].remove();
  //kart evvelki veziyyetine qayidir
  let parent_kart_mins = exit_button[1].querySelector('.kart');
  let althisse_kart_mins = parent_kart_mins.closest('.althisse');
  parent_kart_mins.remove();
  let svg_kart_mins = (`<svg
    xmlns="http://www.w3.org/2000/svg" width="14.4" height="12"
    viewBox="0 0 14.4 12">
    <g data-name="Group 120" transform="translate(-288 -413.89)">
        <path data-name="Path 154" fill="currentColor"
            d="M298.7,418.289l-2.906-4.148a.835.835,0,0,0-.528-.251.607.607,0,0,0-.529.251l-2.905,4.148h-3.17a.609.609,0,0,0-.661.625v.191l1.651,5.84a1.336,1.336,0,0,0,1.255.945h8.588a1.261,1.261,0,0,0,1.254-.945l1.651-5.84v-.191a.609.609,0,0,0-.661-.625Zm-5.419,0,1.984-2.767,1.98,2.767Zm1.984,5.024a1.258,1.258,0,1,1,1.319-1.258,1.3,1.3,0,0,1-1.319,1.258Zm0,0">
        </path>
    </g>
</svg>`);
  let card_button = $(`<p class="kart rounded-pill border bg-white  p-2 pr-4 pl-4">${svg_kart_mins}Cart</p>`);
  $(althisse_kart_mins).append(card_button);
  // if (exit_button[2]) {
  //   exit_button[2].querySelector('.modalcart').innerHTML='';

  // }
  //........
  document.querySelectorAll('.backet-item').forEach((items) => {
    items.innerHTML = product_item;
  })
  exit_button[0].querySelectorAll('.products-money').forEach((element) => {
    element.innerHTML = product_sum;
  })
  exit_button[0].querySelectorAll('.products-count').forEach((element) => {
    element.innerHTML = product_count;
  })
  document.querySelectorAll('.all-sum').forEach((element) => {
    element.innerHTML = product_allsum;
  })


}

//
function addItem(id) {
  let parent = document.querySelectorAll(`[product_id="${id}"]`);
  console.log(parent)
  let card_price = parent[1].querySelector('.card-money').innerText;
  card_price = parseInt(card_price.replace('$', ''));
  let product_count = parseInt(parent[1].querySelector('.products-count').innerText);
  let product_allsum = parseFloat(document.querySelector('.all-sum').textContent);
  product_count++;
  sum = product_count * card_price;
  product_allsum = parseFloat(product_allsum + card_price).toFixed(2);
  console.log(product_allsum, card_price)

  document.querySelectorAll('.all-sum').forEach((element) => {
    element.innerHTML = product_allsum;
  })

  parent.forEach((parent_element) => {
    parent_element.querySelectorAll('.products-count').forEach((element) => {
      element.innerHTML = product_count;
    })
  })

  parent.forEach((parent_element) => {
    parent_element.querySelectorAll('.products-money').forEach((element) => {
      element.innerHTML = sum;
    })
  })
}
//
function removeItem(id) {
  let parent = document.querySelectorAll(`[product_id="${id}"]`);
  let card_price = parent[1].querySelector('.card-money').innerText;
  card_price = parseInt(card_price.replace('$', ''));
  let product_count = parseInt(parent[0].querySelector('.products-count').textContent);
  let product_allsum = parseFloat(document.querySelector('.all-sum').textContent);
  product_count--;
  sum = product_count * card_price;
  product_allsum = parseFloat(product_allsum - card_price).toFixed(2);
  //kart evvelki veziyyetine qayidir
  if (product_count == 0) {
    itemRemove(id);
    console.log(parent)
    let parent_kart_mins = parent[1].querySelector('.kart');
    let althisse_kart_mins = parent_kart_mins.closest('.althisse');
    parent_kart_mins.remove();
    let svg_kart_mins = (`<svg
    xmlns="http://www.w3.org/2000/svg" width="14.4" height="12"
    viewBox="0 0 14.4 12">
    <g data-name="Group 120" transform="translate(-288 -413.89)">
        <path data-name="Path 154" fill="currentColor"
            d="M298.7,418.289l-2.906-4.148a.835.835,0,0,0-.528-.251.607.607,0,0,0-.529.251l-2.905,4.148h-3.17a.609.609,0,0,0-.661.625v.191l1.651,5.84a1.336,1.336,0,0,0,1.255.945h8.588a1.261,1.261,0,0,0,1.254-.945l1.651-5.84v-.191a.609.609,0,0,0-.661-.625Zm-5.419,0,1.984-2.767,1.98,2.767Zm1.984,5.024a1.258,1.258,0,1,1,1.319-1.258,1.3,1.3,0,0,1-1.319,1.258Zm0,0">
        </path>
    </g>
</svg>`);
    let card_button = $(`<p class="kart rounded-pill border bg-white  p-2 pr-4 pl-4">${svg_kart_mins}Cart</p>`);
    $(althisse_kart_mins).append(card_button);
    let card_button_modal = $(`<span class="card_modal">${svg_kart_mins}Cart<span>`);
    let child_modalcart = parent[2].querySelector('.child_modalcart');
    let product_id = parent[2].getAttribute('product_id');
    console.log(child_modalcart)
    let xxx = child_modalcart.closest('.modalcart');
    child_modalcart.remove();
    $(xxx).append(card_button_modal);
    //........
    let modalcart = document.querySelector('.modalcart');
    let child_modalcart2 = document.createElement('div');
    child_modalcart2.classList.add('child_modalcart')
    let card_group_inc_dec = document.createElement('div');
    card_group_inc_dec.classList.add('js-inc-dec')
    let card_group_increase = document.createElement('div');
    card_group_increase.classList.add('increase');
    card_group_increase.style.color = "#77798c";
    card_group_increase.style.cursor = "pointer";
    let svg_plus = `<svg xmlns="http://www.w3.org/2000/svg" width="12px" height="12px" viewBox="0 0 12 12"><g id="Group_3351" data-name="Group 3351" transform="translate(-1367 -190)"><rect data-name="Rectangle 520" width="12" height="2" rx="1" transform="translate(1367 195)" fill="currentColor"></rect><rect data-name="Rectangle 521" width="12" height="2" rx="1" transform="translate(1374 190) rotate(90)" fill="currentColor"></rect></g></svg>`
    card_group_increase.innerHTML = svg_plus;
    let card_group_count = document.createElement('div');
    card_group_count.classList.add('products-count', 'style-count');
    let card_group_decrease = document.createElement('div');
    card_group_decrease.classList.add('decrease');
    card_group_decrease.style.color = "#77798c";
    card_group_decrease.style.cursor = "pointer";
    let svg_minus = `<svg xmlns="http://www.w3.org/2000/svg" width="12px" height="2px" viewBox="0 0 12 2"><rect data-name="Rectangle 522" width="12" height="2" rx="1" fill="currentColor"></rect></svg>`;
    card_group_decrease.innerHTML = svg_minus;
    card_button_modal.click(function () {
      let target_element = document.querySelector('.kart');
      let x = parent[1];
      inModal(x, id, x, target_element);
      modalcart.innerHTML = ' ';
      xxx.appendChild(card_group_decrease);
      card_group_count.innerHTML = 1;
      xxx.appendChild(card_group_count);
      xxx.appendChild(card_group_increase);
      modalcart.appendChild(child_modalcart2);
    })
    card_group_increase.addEventListener('click', function () {
      addItem(product_id);
    })
    card_group_decrease.addEventListener('click', function () {
      removeItem(product_id);
    })
    //..........
  }
  else {
    document.querySelectorAll('.all-sum').forEach((element) => {
      element.innerHTML = product_allsum;
    })

    parent.forEach((parent_element) => {
      parent_element.querySelectorAll('.products-money').forEach((element) => {
        element.innerHTML = sum;
      })
    })
    parent.forEach((parent_element) => {
      parent_element.querySelectorAll('.products-count').forEach((element) => {
        element.innerHTML = product_count;
      })
    })

  }
}
$(document).ready(function () {

  $('.multiple-items').slick({
    slidesToShow: 3,
    slidesToScroll: 1,
    arrows: true,
    prevArrow: '<button class="prevButton"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" width="20"><path d="M217.9 256L345 129c9.4-9.4 9.4-24.6 0-33.9-9.4-9.4-24.6-9.3-34 0L167 239c-9.1 9.1-9.3 23.7-.7 33.1L310.9 417c4.7 4.7 10.9 7 17 7s12.3-2.3 17-7c9.4-9.4 9.4-24.6 0-33.9L217.9 256z" fill="currentColor" stroke="currentColor"></path></svg></button>',
    nextArrow: '<button class="nextButton"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" width="20"><path d="M294.1 256L167 129c-9.4-9.4-9.4-24.6 0-33.9s24.6-9.3 34 0L345 239c9.1 9.1 9.3 23.7.7 33.1L201.1 417c-4.7 4.7-10.9 7-17 7s-12.3-2.3-17-7c-9.4-9.4-9.4-24.6 0-33.9l127-127.1z" fill="currentColor" stroke="currentColor"></path></svg></button>',
  });

  function sameId(categoryId) {
    var requestURL;
    if (typeof categoryId === 'undefined') {
      requestURL = `http://35.225.243.133/api/products/`;
    } else {
      requestURL = `http://35.225.243.133/api/products/?category=${categoryId}`;
    }
    $.ajax({
      url: requestURL,
      method: 'GET',
      success: function (response) {
        $('.sub-products').text('');
        for (let product of response) {
          $('.sub-products').append(` 
          <div class="col-6 col-lg-3 col-md-4 ">
                  <div class="mt-5 card " style="width: 13rem;cursor:pointer" product_id="${product.id}" onclick="addToCard(this,${product.id})">
                      <img class="card-img-top" style="height: 180px;"
                          src="${product.main_image}" alt="Card image cap">
                      <div class="card-body">

                          <h6 class="font-weight-bold card-title">${product.title}</h6>
                          <h6 class="h6 card-text ">${product.amount_by_unit} ${product.unit}</h6>
                          <div class="althisse row mx-auto mt-5 justify-content-between">
                              <p class="p-2 card-money text-truncate">$ ${product.price}</p>

                              <p class="kart rounded-pill border bg-white  p-2 pr-4 pl-4"><svg
                                      xmlns="http://www.w3.org/2000/svg" width="14.4" height="12"
                                      viewBox="0 0 14.4 12">
                                      <g data-name="Group 120" transform="translate(-288 -413.89)">
                                          <path data-name="Path 154" fill="currentColor"
                                              d="M298.7,418.289l-2.906-4.148a.835.835,0,0,0-.528-.251.607.607,0,0,0-.529.251l-2.905,4.148h-3.17a.609.609,0,0,0-.661.625v.191l1.651,5.84a1.336,1.336,0,0,0,1.255.945h8.588a1.261,1.261,0,0,0,1.254-.945l1.651-5.84v-.191a.609.609,0,0,0-.661-.625Zm-5.419,0,1.984-2.767,1.98,2.767Zm1.984,5.024a1.258,1.258,0,1,1,1.319-1.258,1.3,1.3,0,0,1-1.319,1.258Zm0,0">
                                          </path>
                                      </g>
                                  </svg>Cart</p>
                          </div>
                      </div>
                  </div>
              </div>`);


        }

      },
      error: function (error_response) {
        alert('Sehvlik bas verdi');
      }
    })
  }

  $.ajax({
    url: 'http://35.225.243.133/api/categories/',
    method: 'GET',
    success: function (response) {

      for (let category of response) {

        var categoryList = $(`<li class="mb-4 categories"><a class=" text-dark">${svg}${category.title}</a></li>`);
        $('.all-list').append(categoryList);
        categoryList.click(function () {
          sameId(category.id);
        })
      }


    },
    error: function (error_response) {
      alert('Sehvlik bas verdi');
    }
  })

  // let list = $('<li class="active","mb-4">');
  // $('.all-list').append(list);
  // let a_list = $('<a class="text-dark">');
  // list.append(a_list);
  sameId();

  //part of join/sign up
  const domain = 'http://35.225.243.133';

  document.querySelector('#form-join').addEventListener('submit', function (event) {
    event.preventDefault();
    let form_data = new Object();
    document.querySelectorAll('#form-join input').forEach((input) => {
      form_data[input.getAttribute('name')] = input.value;

    });

    document.querySelectorAll('#form-join small').forEach((small_tag) => {
      small_tag.innerHTML = '';
    })
    $.ajax({
      url: `${domain}/accounts/api/login/`,
      method: 'POST',
      data: form_data,
      success: function (response) {
        console.log(response);
        alert('Welcome');
        window.location = 'product2.html';
        localStorage.setItem('token', response.token);
        localStorage.setItem('user', username);

      },
      error: function (error_response) {
        console.log(error_response);
        alert('Try again');


        let error_messages = error_response.responseJSON;
        if (error_messages.hasOwnProperty('non_field_errors')) {
          document.querySelector('#non_field_errors').innerText = error_messages['non_field_errors'];
        }
        for (let message_name in error_messages) {
          let input = document.querySelector(`#form-join [name="${message_name}"`);
          if (input) {
            let small_tag = input.parentElement.querySelector('small');
            small_tag.innerText = error_messages[message_name];
          }
        }
      }
    })

  })
  //click sign up
  $('.linkjoin').click(function (click) {
    click.preventDefault();
    $('.joinj').val('');
    $('#form-join2,#form-join').toggle();
    $('.input-signup,.signup2,.welcome,.text-secondary,.text-secondary2,.q1-modal,.q2-modal,.reset-modal').toggle();

    if ($('.linkjoin').text() == 'Login') {
      $('.linkjoin').text('Sign Up');
    }
    else {
      $('.linkjoin').text('Login');
    }

  })

  document.querySelector('#form-join2').addEventListener('submit', function (event) {
    event.preventDefault();
    let data_form = $('#form-join2').serializeArray();
    document.querySelectorAll('#form-join2 small').forEach((small_tag) => {
      small_tag.innerHTML = '';
    })
    $.ajax({
      url: `${domain}/accounts/api/register/`,
      method: 'POST',
      data: data_form,
      success: function (response) {
        alert('Welcome');
        console.log(response);
      },
      error: function (error_response) {
        alert('Try again');
        console.log(error_response);

        let error_messages = error_response.responseJSON;
        if (error_messages.hasOwnProperty('non_field_errors')) {
          document.querySelector('#non_field_errors2').innerText = error_messages['non_field_errors'];
        }
        for (let message_name in error_messages) {
          let input = document.querySelector(`#form-join2 [name="${message_name}"`);
          if (input) {
            let small_tag = input.parentElement.querySelector('small');
            small_tag.innerText = error_messages[message_name];
          }
        }
      }
    })


  })
});
var data = [];
if (localStorage.getItem('lcl_all')) {
  data = JSON.parse(localStorage.getItem('lcl_all'));
  console.log(data)

}

//
function inModal(x, id, card_body_parent, target_element) {
  var card_title = card_body_parent.getElementsByClassName("card-title")[0].innerHTML;
  var card_pc = card_body_parent.getElementsByClassName("card-text")[0].innerHTML;
  var card_price = card_body_parent.getElementsByClassName("card-money")[0].innerHTML;
  var card_img = card_body_parent.getElementsByClassName("card-img-top")[0];
  var card_img_src = card_img.getAttribute('src');
  var count = 1;
  card_price = parseFloat(card_price.replace('$', ''));
  var sum = card_price;
  sum = parseFloat(sum).toFixed(2);


  var all_sum;
  all_sum = parseFloat(all_sum).toFixed(2);
  all_sum = parseFloat(document.querySelector('.all-sum').textContent);
  all_sum = parseFloat(all_sum + card_price).toFixed(2);
  all_sum = parseFloat(all_sum).toFixed(2);

  document.getElementsByClassName('elmnt4')[0].classList.add('d-none');

  if (!target_element.closest('.kart').classList.contains('d-flex')) {

    document.querySelectorAll('.all-sum').forEach((Element) => {
      Element.innerHTML = all_sum;
    })


    let card_products = document.querySelector('#card_products');
    let card_group_div1 = document.createElement('div');
    card_group_div1.classList.add('card');
    card_group_div1.style.maxWidth = "540px";
    card_group_div1.setAttribute("product_id", id);
    // card_group_div1.setAttribute("product_titl", id);


    let card_group_div2 = document.createElement('div');
    card_group_div2.classList.add('row', 'no-gutters');



    let card_group_col4 = document.createElement('div');
    card_group_col4.classList.add('col-md-4', 'jsleft');

    let card_group_inc_dec = document.createElement('div');
    card_group_inc_dec.classList.add('js-inc-dec')
    let card_group_increase = document.createElement('div');
    card_group_increase.classList.add('increase');
    card_group_increase.style.color = "#77798c";
    card_group_increase.style.cursor = "pointer";
    let svg_plus = `<svg xmlns="http://www.w3.org/2000/svg" width="12px" height="12px" viewBox="0 0 12 12"><g id="Group_3351" data-name="Group 3351" transform="translate(-1367 -190)"><rect data-name="Rectangle 520" width="12" height="2" rx="1" transform="translate(1367 195)" fill="currentColor"></rect><rect data-name="Rectangle 521" width="12" height="2" rx="1" transform="translate(1374 190) rotate(90)" fill="currentColor"></rect></g></svg>`
    card_group_increase.innerHTML = svg_plus;
    let card_group_count = document.createElement('div');
    card_group_count.classList.add('products-count', 'style-count');
    card_group_count.innerText = count;
    let card_group_decrease = document.createElement('div');
    card_group_decrease.classList.add('decrease');
    card_group_decrease.style.color = "#77798c";
    card_group_decrease.style.cursor = "pointer";
    let svg_minus = `<svg xmlns="http://www.w3.org/2000/svg" width="12px" height="2px" viewBox="0 0 12 2"><rect data-name="Rectangle 522" width="12" height="2" rx="1" fill="currentColor"></rect></svg>`;
    card_group_decrease.innerHTML = svg_minus;
    card_group_inc_dec.appendChild(card_group_increase);
    card_group_inc_dec.appendChild(card_group_count);
    card_group_inc_dec.appendChild(card_group_decrease);



    let card_group_div3 = document.createElement('div');
    let card_group_img = document.createElement('img');
    card_group_img.classList.add('card-img', 'js-img-style');
    card_group_img.setAttribute('src', card_img_src);
    card_group_div3.appendChild(card_group_img);

    card_group_col4.appendChild(card_group_inc_dec);
    card_group_col4.appendChild(card_group_div3);

    let card_group_col8 = document.createElement('div');
    card_group_col8.classList.add('col-md-8');

    let card_group_card_body = document.createElement('div');
    card_group_card_body.classList.add('card-body', 'js-card-body');

    let card_group_card_title = document.createElement('h5');
    card_group_card_title.classList.add('card-title', 'js-tittle');
    card_group_card_title.innerText = card_title;

    let card_group_div4 = document.createElement('div');
    card_group_div4.classList.add('js-price-line');
    let card_group_price = document.createElement('p');
    card_group_price.classList.add('card-text', 'js-text');
    card_group_price.innerText = `$ ${card_price}`;
    card_group_div4.appendChild(card_group_price);


    let card_group_div5 = document.createElement('div');
    card_group_div5.classList.add('js-div5');
    let card_group_sign_money = document.createElement('p');
    card_group_sign_money.classList.add('dollar');
    card_group_sign_money.innerText = '$';
    let card_group_sum = document.createElement('p');
    card_group_sum.classList.add('products-money');
    card_group_sum.innerText = sum;
    let card_group_exit = document.createElement('span');
    card_group_exit.style.marginLeft = "20px";
    card_group_exit.innerHTML = `<svg class="elmnt3 backet2 js-exit" xmlns="http://www.w3.org/2000/svg" width="10.003" height="10" viewBox="0 0 10.003 10">
<path data-name="_ionicons_svg_ios-close (5)" d="M166.686,165.55l3.573-3.573a.837.837,0,0,0-1.184-1.184l-3.573,3.573-3.573-3.573a.837.837,0,1,0-1.184,1.184l3.573,3.573-3.573,3.573a.837.837,0,0,0,1.184,1.184l3.573-3.573,3.573,3.573a.837.837,0,0,0,1.184-1.184Z" transform="translate(-160.5 -160.55)" fill="currentColor"></path>
</svg>`


    card_group_div5.appendChild(card_group_sign_money);
    card_group_div5.appendChild(card_group_sum);
    card_group_div5.appendChild(card_group_exit);
    card_group_div4.appendChild(card_group_div5);

    let card_group_div6 = document.createElement('div');
    card_group_div6.classList.add('d-flex', 'js-money');
    let card_group_count2 = document.createElement('span');
    card_group_count2.classList.add('products-count', 'mr-1');
    card_group_count2.innerText = count;
    let card_group_card_money = document.createElement('span');
    card_group_card_money.classList.add('card-money');
    card_group_card_money.innerText = `X ${card_pc}`;
    card_group_div6.appendChild(card_group_count2);
    card_group_div6.appendChild(card_group_card_money);

    card_group_card_body.appendChild(card_group_card_title);
    card_group_card_body.appendChild(card_group_div4);
    card_group_card_body.appendChild(card_group_div6);

    card_group_col8.appendChild(card_group_card_body);

    card_group_div2.appendChild(card_group_col4);
    card_group_div2.appendChild(card_group_col8);

    card_group_div1.appendChild(card_group_div2);

    card_products.appendChild(card_group_div1);

    // kart + -
    let change_kart = x.querySelector('.kart');
    let kart_minus = card_group_decrease.cloneNode(true);
    change_kart.classList.add('d-flex', 'kart2');
    change_kart.innerHTML = '';
    // kart_minus.innerText = '-';
    // let jcount = parseFloat(document.querySelector('.products-count').textContent);
    let kart_number = card_group_count.cloneNode(true);
    // kart_number.innerText = jcount;
    let kart_plus = card_group_increase.cloneNode(true);
    // kart_plus.innerText = '+';
    change_kart.appendChild(kart_minus);
    change_kart.appendChild(kart_number);
    change_kart.appendChild(kart_plus);




    // azaldir




    card_group_increase.addEventListener('click', function () {
      addItem(id);
    })

    card_group_decrease.addEventListener('click', function () {
      removeItem(id);
      let exit_button = this.closest('.card');
      let product_count = parseInt(exit_button.querySelector('.products-count').textContent);
      if (product_count == 0) {
        itemRemove(id);

      }
    })

    card_group_exit.addEventListener('click', function () {
      itemRemove(id);
    })




    kart_plus.addEventListener('click', function () {
      addItem(id);
    })
    kart_minus.addEventListener('click', function () {
      removeItem(id);
    })
  }
  // localestorage
  // var localestorageSum=document.querySelector('.all-sum').innerHTML;
  // localStorage.setItem('allsum', localestorageSum);


  // CHANGING BASKET ITEMS COUNT
  var es = document.getElementById('card_products').children;
  document.querySelectorAll('.backet-item').forEach((items) => {
    items.innerHTML = es.length;
  })


  // let parent_localstorage = document.querySelectorAll(`[product_id="${id}"]`);
  // let localStorage_product_count = parseInt(parent_localstorage[0].querySelector('.products-count').textContent);
  // // let localStorage_product_allsum = parseFloat(document.querySelector('.all-sum').textContent);
  // // let localStorage_product_sum = parseFloat(parent_localstorage[0].querySelector('.products-money').textContent);
  // // let localStorage_product_cardprice = parent_localstorage[0].querySelector('.card-text').innerHTML;
  // // let localStorage_product_item = parseInt(document.querySelector('.backet-item').textContent);
  // // console.log(localStorage_product_cardprice);
  // let localStorage_data = {
  //   "lcl_product_count": localStorage_product_count,
  //   "lcl_product_id": id,
  // }
  // // console.log(localStorage_data)
  // if (data.length == 0) {
  //   data.push(localStorage_data);
  //   localStorage.setItem('lcl_all', JSON.stringify(localStorage_data));
  // }
  // else {
  //   for (let i = 0; i < data.length; i++) {
  //     if (data[i]['lcl_product_id'] === localStorage_data[i]['lcl_product_id']) {
  //       data[i]['lcl_product_count'] = localStorage_data[i]['lcl_product_count'];
  //       localStorage.setItem('lcl_all', JSON.stringify(localStorage_data));
  //     }
  //   }
  // }
}
//
function addToCard(x, id) {
  console.log(event);
  console.log(event.target);

  var card_body_parent = event.target.closest('.card');
  var target_element = event.target;

  if (target_element.closest('.kart') != null) {
    if (card_body_parent != null) {
      inModal(x, id, card_body_parent, target_element);
    }
  }

  else {
    document.querySelector('#cardbutton').click();
    let product_id = x.getAttribute('product_id');
    document.querySelector('#exampleModal1').setAttribute('product_id', product_id);
    let card_img_top = x.querySelector('.card-img-top').getAttribute('src');
    document.querySelector('.product-image').setAttribute('src', card_img_top);
    document.querySelectorAll('.subproduct-image').forEach((element) => {
      element.setAttribute('src', card_img_top);
      let card_img_title = x.querySelector('.card-title').innerText;
      document.querySelector('.modal-title').innerText = card_img_title;
      let card_img_text = x.querySelector('.card-text').innerText;
      document.querySelector('.modal-pc').innerText = card_img_text;
      let card_img_money = x.querySelector('.card-money').innerText;
      document.querySelector('.pul').innerText = card_img_money;


      let modalcart = document.querySelector('.modalcart');
      let child_modalcart = document.createElement('div');
      child_modalcart.classList.add('child_modalcart')
      let card_group_inc_dec = document.createElement('div');
      card_group_inc_dec.classList.add('js-inc-dec')
      let card_group_increase = document.createElement('div');
      card_group_increase.classList.add('increase');
      card_group_increase.style.color = "#77798c";
      card_group_increase.style.cursor = "pointer";
      let svg_plus = `<svg xmlns="http://www.w3.org/2000/svg" width="12px" height="12px" viewBox="0 0 12 12"><g id="Group_3351" data-name="Group 3351" transform="translate(-1367 -190)"><rect data-name="Rectangle 520" width="12" height="2" rx="1" transform="translate(1367 195)" fill="currentColor"></rect><rect data-name="Rectangle 521" width="12" height="2" rx="1" transform="translate(1374 190) rotate(90)" fill="currentColor"></rect></g></svg>`
      card_group_increase.innerHTML = svg_plus;
      let card_group_count = document.createElement('div');
      card_group_count.classList.add('products-count', 'style-count');
      if (x.querySelector('.products-count') != null) {
        card_group_count.innerText = x.querySelector('.products-count').innerHTML;
      }
      else {

        modalcart.innerHTML = ' ';
        let inside_card = `<span class="card_modal"><svg
        xmlns="http://www.w3.org/2000/svg" width="14.4" height="12"
        viewBox="0 0 14.4 12">
        <g data-name="Group 120" transform="translate(-288 -413.89)">
            <path data-name="Path 154" fill="currentColor"
                d="M298.7,418.289l-2.906-4.148a.835.835,0,0,0-.528-.251.607.607,0,0,0-.529.251l-2.905,4.148h-3.17a.609.609,0,0,0-.661.625v.191l1.651,5.84a1.336,1.336,0,0,0,1.255.945h8.588a1.261,1.261,0,0,0,1.254-.945l1.651-5.84v-.191a.609.609,0,0,0-.661-.625Zm-5.419,0,1.984-2.767,1.98,2.767Zm1.984,5.024a1.258,1.258,0,1,1,1.319-1.258,1.3,1.3,0,0,1-1.319,1.258Zm0,0">
            </path>
        </g>
    </svg>Cart<span>`;
        modalcart.innerHTML = inside_card;
        $('.card_modal').click(function () {
          let target_element = document.querySelector('.kart');
          inModal(x, id, card_body_parent, target_element);
          modalcart.innerHTML = ' ';
          child_modalcart.appendChild(card_group_decrease);
          card_group_count.innerHTML = 1;
          child_modalcart.appendChild(card_group_count);
          child_modalcart.appendChild(card_group_increase);
          modalcart.appendChild(child_modalcart);
        })
      }

      let card_group_decrease = document.createElement('div');
      card_group_decrease.classList.add('decrease');
      card_group_decrease.style.color = "#77798c";
      card_group_decrease.style.cursor = "pointer";
      let svg_minus = `<svg xmlns="http://www.w3.org/2000/svg" width="12px" height="2px" viewBox="0 0 12 2"><rect data-name="Rectangle 522" width="12" height="2" rx="1" fill="currentColor"></rect></svg>`;
      card_group_decrease.innerHTML = svg_minus;
      if (card_group_count.innerText != 0) {
        console.log('aa');
        modalcart.innerHTML = ' ';
        modalcart.appendChild(card_group_decrease);
        modalcart.appendChild(card_group_count);
        modalcart.appendChild(card_group_increase);
      }
      card_group_increase.addEventListener('click', function () {
        console.log('ac')
        addItem(product_id);
      })


      //   if (document.querySelector('.products-count') != null && document.querySelector('.products-count').textContent == 1) {
      //   document.querySelector('.products-count').textContent = 0;
      //   console.log(document.querySelector('.products-count').textContent)
      //   card_group_decrease.addEventListener('click', function () {
      //     removeItem(product_id);
      //     card_group_count.innerHTML = 0;

      //   })
      // }
      // else {
      card_group_decrease.addEventListener('click', function () {
        removeItem(product_id);
      })
      // }

    })
  }
  // localestorage
  //   const sum_all = localStorage.getItem('allsum');
  //   document.querySelector('.all-sum').innerHTML = sum_all;



}





